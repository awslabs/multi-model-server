
execution:
- concurrency: 4
  ramp-up: 1s
  hold-for: 20s
  scenario: Inference
scenarios:
  Inference:
    script: register_and_inference.jmx

modules:
  jmeter:
    properties:
      port : 8080
      management_port : 8081
      protocol : http
      input_filepath : kitten.jpg


services:
  - module: monitoring
    server-agent:
      - address: localhost:9009 # metric monitoring service address
        label: mms-inference-server  # if you specify label, it will be used in reports instead of ip:port
        interval: 1s    # polling interval
        logging: True # those logs will be saved to "SAlogs_192.168.0.1_9009.csv" in the artifacts dir
        metrics: # metrics should be supported by monitoring service
          - sum_cpu_percent # cpu percent used by all the mms server processes and workers
          - sum_memory_percent
          - sum_num_handles
          - server_workers # no of mms workers


reporting:
- module: passfail
  criteria:
  - fail of s2_fail >50%, stop as failed
  - p90 of s2_p90 >250ms  , stop as failed
  - avg-rt of s2_avg_rt >1s , stop as failed
  - class: bzt.modules.monitoring.MonitoringCriteria
    subject: mms-inference-server/sum_num_handles
    condition: '>'
    threshold: 80
    timeframe: 1s
    fail: true
    stop: true
- module: junit-xml
  data-source: pass-fail
- module: junit-xml
  data-source: sample-labels
- module: final-stats
  dump-csv : ${BASEDIR}/final_stats.csv

settings:
  env:
    BASEDIR : '.'