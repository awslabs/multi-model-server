---
execution:
- concurrency: 1
  ramp-up: 0s
  iterations: 1
  scenario: Downscale

scenarios:
  Downscale:
    script: downscale_workers.jmx

services:
  - module: shellexec
    prepare:
    - bzt tests/common/setup.jmx tests/common/global_config.yaml -o settings.artifacts-dir=/tmp/mms_perf/
    post-process:
    - bzt tests/common/teardown.jmx tests/common/global_config.yaml -o settings.artifacts-dir=/tmp/mms_perf/
  - module: server_local_monitoring
    ServerLocalClient:
    - interval: 1s
      metrics:
        - total_workers

modules:
  server_local_monitoring:
    class : metrics_monitoring_taurus.Monitor # monitoring class.
  new_passfail:
    class: new_passfail.PassFailStatus

reporting:
- module: passfail
  criteria:
    - class: bzt.modules.monitoring.MonitoringCriteria
      subject: ServerLocalClient/total_workers
      condition: '<'
      threshold: 2
      timeframe: 1s
      stop : true
      fail : true