{
 "execution": [
  {
   "concurrency": 4,
   "ramp-up": "1s",
   "hold-for": "20s",
   "scenario": "Inference"
  }
 ],
 "scenarios": {
  "Inference": {
   "script": "register_and_inference.jmx"
  }
 },
 "services": [
  {
   "module": "monitoring",
   "server-agent": [
    {
     "address": "localhost:9009",
     "label": "mms-inference-server",
     "interval": "1s",
     "logging": true,
     "metrics": [
      "sum_workers_cpu_percent",
      "sum_workers_memory_percent",
      "sum_workers_file_descriptors",
      "total_workers"
     ]
    }
   ]
  }
 ],
 "reporting": [
  {
   "module": "passfail",
   "criteria": [
    "fail of s2_fail >50%, stop as failed",
    "p90 of s2_p90 >250ms  , stop as failed",
    "avg-rt of s2_avg_rt >1s , stop as failed",
    {
     "class": "bzt.modules.monitoring.MonitoringCriteria",
     "subject": "mms-inference-server/sum_workers_file_descriptors",
     "condition": ">",
     "threshold": 80,
     "timeframe": "1s",
     "fail": true,
     "stop": true
    }
   ]
  },
  {
   "module": "passfail"
  },
  {
   "module": "junit-xml",
   "data-source": "pass-fail"
  },
  {
   "module": "junit-xml",
   "data-source": "sample-labels"
  },
  {
   "module": "final-stats",
   "dump-csv": "${BASEDIR}/final_stats.csv"
  }
 ],
 "modules": {
  "jmeter": {
   "properties": {
    "hostname": "127.0.0.1",
    "port": 8080,
    "management_port": 8081,
    "protocol": "http",
    "input_filepath": "kitten.jpg"
   }
  }
 },
 "settings": {
  "env": {
   "BASEDIR": "."
  }
 }
}
