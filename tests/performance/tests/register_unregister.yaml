---
execution:
- concurrency: 1
  ramp-up: 0s
  iterations: 5
  scenario: register_unregister

scenarios:
  register_unregister:
    script: register_unregister.jmx

modules:
  server_local_monitoring:
    class : metrics_monitoring_taurus.Monitor

services:
  - module: server_local_monitoring
    ServerLocalClient:
      - interval: 1s
        metrics:
          - total_processes
          - sum_all_file_descriptors
          - frontend_memory_rss

reporting:
- module: passfail
  criteria:
    - class: bzt.modules.monitoring.MonitoringCriteria
      subject: ServerLocalClient/total_processes
      condition: '>'
      threshold: 1
      timeframe: 5s
      stop : true
      fail : true
    - class: bzt.modules.monitoring.MonitoringCriteria
      subject: ServerLocalClient/sum_all_file_descriptors
      condition: '>'
      threshold: 66
      timeframe: 5s
      stop : true
      fail : true
#    - class: bzt.modules.monitoring.MonitoringCriteria
#      subject: ServerLocalClient/frontend_memory_rss
#      condition: '>'
#      threshold: 75000000 #75MB
#      timeframe: 5s
#      stop : true
#      fail : true